<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort üìù ‚Äî Bar Chart</title>
<style>
  :root{
    --bg:#0f1220; --panel:#161a2d; --panel-2:#1e2340;
    --text:#ecf2ff; --muted:#a6b0cf;
    --pair:#ffd166; --active:#6cf3ff; --done:#8ae9c1;
    --edge:#556; --edge-pair:#e3b84a; --edge-done:#6fae97;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: radial-gradient(1200px 800px at 70% -10%, #20264a 0%, var(--bg) 40%);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
    min-height:100vh; padding:32px 16px 64px; display:grid; place-items:start center;
  }
  .app{ width:min(1100px,100%); display:grid; gap:16px; }

  .panel{
    background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%);
    border:1px solid #1a2040; border-radius:14px; box-shadow:var(--shadow); padding:18px;
  }
  .title-row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
  h1{ margin:0; font-size:clamp(22px,3vw,28px);}
  .badge{ background:#0b1022; border:1px solid #28305a; color:var(--muted); padding:6px 10px; border-radius:999px; font-size:12px; display:inline-flex; gap:6px; align-items:center;}
  .badge b{ color:var(--text); }

  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  label{ color:var(--muted); font-size:14px;}
  input[type="number"]{
    background:#0d1126; border:1px solid #242b51; color:var(--text); border-radius:10px; padding:8px 10px; outline:none;
  }
  input[type="range"]{ accent-color: var(--active); }
  button{
    background:#0e1736; color:var(--text); border:1px solid #2b3563; border-radius:12px; padding:10px 14px; cursor:pointer;
    transition:transform .05s ease, background .15s ease, border-color .15s ease;
  }
  button:hover{ background:#121c44; }
  button:active{ transform:translateY(1px); }
  button.primary{ background:linear-gradient(180deg,#0f2b3a,#0b1f2b); border-color:#284a60; }
  button:disabled{ opacity:.55; cursor:not-allowed; }

  /* Chart */
  .chart{
    height:340px; display:flex; align-items:flex-end; gap:8px;
    padding:12px; border-radius:12px; background:#101634; border:1px solid #222a55; overflow-x:auto;
  }
  .bar{
    --w: 26px;
    width: var(--w);
    background: linear-gradient(180deg, #0c1128, #0a0f22);
    border:1px solid #27305b; border-radius:8px 8px 4px 4px;
    display:flex; align-items:flex-end; justify-content:center;
    position:relative;
    transition: height .28s ease, background .2s ease, outline .2s ease, border-color .2s ease;
    box-shadow: inset 0 0 0 1px #0b1026, var(--shadow);
  }
  .bar .label{
    position:absolute; top:-22px; left:50%; transform:translateX(-50%);
    font:11px/1 ui-monospace, Menlo, Consolas; color:var(--muted);
    background:#0b1026; padding:3px 6px; border-radius:6px; border:1px solid #222a55;
    pointer-events:none;
  }
  .bar.key{ outline:3px solid var(--pair); }
  .bar.scan{ outline:2px solid var(--active); }
  .bar.shift{ border-color: var(--edge-pair); }
  .bar.done{ background:#0d1f22; border-color: var(--edge-done); }
  .bar.done::after{
    content:"‚úì"; position:absolute; bottom:-18px; left:50%; transform:translateX(-50%);
    font-size:12px; color:var(--done);
  }

  .legend{ display:flex; gap:14px; flex-wrap:wrap; color:var(--muted); font-size:14px;}
  .dot{ width:10px; height:10px; border-radius:999px; display:inline-block; margin-right:6px; vertical-align:middle;}
  .dot.active{ background:var(--active); }
  .dot.pair{ background:var(--pair); }
  .dot.done{ background:var(--done); }

  pre{ margin:0; background:#0b1026; border:1px solid #222a55; border-radius:12px; padding:14px; overflow:auto; box-shadow:var(--shadow); color:var(--text);}
  code{ font:13px/1.45 ui-monospace, Menlo, Consolas; }
  .muted{ color:var(--muted); }
</style>
</head>
<body>
<main class="app">
  <section class="panel">
    <div class="title-row">
      <h1>Insertion Sort üìù ‚Äî Insert ‚Äúcard in hand‚Äù into the sorted prefix</h1>
      <span class="badge">‚è± Time: <b>O(n¬≤)</b></span>
      <span class="badge">üì¶ Space: <b>O(1)</b></span>
    </div>
  </section>

  <section class="panel">
    <div class="row">
      <label>Size</label>
      <input id="size" type="number" min="3" max="80" value="20" style="width:90px" />
      <button id="random" class="primary">Randomize</button>
      <button id="nearly">Nearly-sorted</button>
      <span class="badge">i: <b id="iLbl">1</b></span>
      <span class="badge">j: <b id="jLbl">0</b></span>
      <span class="badge">Comparisons: <b id="cmp">0</b></span>
      <span class="badge">Shifts: <b id="shf">0</b></span>
    </div>
    <div class="row" style="margin-top:8px;">
      <button id="play" class="primary">‚ñ∂ Play</button>
      <button id="step">‚è≠ Step</button>
      <button id="reset">‚ôª Reset</button>
      <label style="margin-left:8px;">Speed</label>
      <input id="speed" type="range" min="0" max="100" value="45" />
      <span id="speedLabel" class="muted">Medium</span>
    </div>
  </section>

  <section class="panel chart" id="chart" aria-label="Bar chart"></section>
  <div class="legend panel">
    <span><span class="dot pair"></span> Key (card in hand)</span>
    <span><span class="dot active"></span> Comparing with j</span>
    <span><span class="dot done"></span> Sorted prefix</span>
  </div>

  <section class="panel">
    <h2 style="margin:0 0 10px;">Pseudo-code</h2>
<pre><code>function insertionSort(arr):
    for i ‚Üê 1 to n-1:
        key ‚Üê arr[i]
        j ‚Üê i - 1
        while j ‚â• 0 and arr[j] &gt; key:
            arr[j+1] ‚Üê arr[j]      // shift right
            j ‚Üê j - 1
        arr[j+1] ‚Üê key             // place key
</code></pre>
    <p class="muted">We maintain a growing sorted prefix on the left and insert each new element in its correct position‚Äîjust like arranging playing cards.</p>
  </section>
</main>

<script>
  // ---------- State ----------
  const state = {
    arr: [],
    n: 0,
    i: 1,          // current element index to insert
    j: 0,          // scan index inside sorted prefix
    key: null,     // value of the "card in hand"
    hole: 1,       // where the key will be placed
    phase: 'pick', // 'pick' | 'shift' | 'place'
    cmp: 0,
    shf: 0,
    running: false,
    delay: 380
  };

  // ---------- DOM ----------
  const elChart = document.getElementById('chart');
  const elSize = document.getElementById('size');
  const btnRandom = document.getElementById('random');
  const btnNearly = document.getElementById('nearly');
  const btnPlay = document.getElementById('play');
  const btnStep = document.getElementById('step');
  const btnReset = document.getElementById('reset');
  const elI  = document.getElementById('iLbl');
  const elJ  = document.getElementById('jLbl');
  const elCmp = document.getElementById('cmp');
  const elShf = document.getElementById('shf');
  const elSpeed = document.getElementById('speed');
  const elSpeedLabel = document.getElementById('speedLabel');

  // ---------- Utils ----------
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  const wait = (ms)=>new Promise(r=>setTimeout(r,ms));
  function speedToDelay(v){ const t=clamp(v,0,100)/100; const eased = 1-Math.pow(t,1.6); return 60+Math.round(eased*740); }
  function labelSpeed(v){ v=+v; if(v<20) return 'Fastest'; if(v<40) return 'Fast'; if(v<60) return 'Medium'; if(v<80) return 'Slow'; return 'Slowest'; }
  function randomArray(n){ return Array.from({length:n},()=>Math.floor(Math.random()*95)+5); }
  function nearlySortedArray(n){
    const base = Array.from({length:n},(_,i)=>Math.round((i+1)*100/n));
    for (let k=0;k<Math.max(1, Math.floor(n*0.08));k++){
      const a=Math.floor(Math.random()*n), b=clamp(a+(Math.random()<0.5?-1:1),0,n-1);
      [base[a], base[b]] = [base[b], base[a]];
    }
    return base;
  }
  function maxVal(arr){ return arr.reduce((m,v)=>v>m?v:m, -Infinity); }

  // ---------- Chart ----------
  function buildChart(){
    elChart.innerHTML = '';
    const M = maxVal(state.arr) || 1;
    state.arr.forEach((v, idx)=>{
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.dataset.index = idx;
      bar.style.height = `${(v/M)*100}%`;
      bar.innerHTML = `<div class="label">${v}</div>`;
      elChart.appendChild(bar);
    });
    paint();
  }
  function getBar(i){ return elChart.children[i]; }
  function setBarValue(i, val){
    const M = maxVal(state.arr) || 1;
    const bar = getBar(i);
    if (!bar) return;
    bar.style.height = `${(val/M)*100}%`;
    bar.querySelector('.label').textContent = val;
  }
  function clearMarks(){
    [...elChart.children].forEach(b=> b.classList.remove('key','scan','shift','done'));
  }
  function paint(){
    clearMarks();
    // sorted prefix is [0 .. i-1] (after placing)
    for (let k=0; k<state.i; k++) getBar(k)?.classList.add('done');

    if (state.phase === 'pick' || state.phase === 'shift' || state.phase === 'place'){
      // highlight key at current hole
      getBar(state.hole)?.classList.add('key');
      // highlight scan element j (if valid)
      if (state.j >= 0 && state.j < state.n) getBar(state.j)?.classList.add('scan');
    }

    elI.textContent = state.i;
    elJ.textContent = state.j;
    elCmp.textContent = state.cmp;
    elShf.textContent = state.shf;
  }

  // ---------- Sorting Logic (one step at a time) ----------
  async function stepOnce(){
    // Completed?
    if (state.i >= state.n){
      state.running = false;
      btnPlay.textContent = '‚ñ∂ Play';
      return;
    }

    if (state.phase === 'pick'){
      // pick up the "card in hand"
      state.key = state.arr[state.i];
      state.hole = state.i;
      state.j = state.i - 1;
      paint();
      state.phase = 'shift';
      return;
    }

    if (state.phase === 'shift'){
      if (state.j >= 0){
        state.cmp++;
        paint();
        // if arr[j] > key, shift arr[j] right into hole
        if (state.arr[state.j] > state.key){
          // move value visually to hole
          getBar(state.hole)?.classList.add('shift');
          state.arr[state.hole] = state.arr[state.j];
          setBarValue(state.hole, state.arr[state.hole]);
          getBar(state.hole)?.classList.remove('shift');

          state.hole = state.hole - 1; // new hole one step left
          state.j    = state.j    - 1; // continue scanning left
          state.shf++;
          paint();
          return; // one shift per step
        }
      }
      // either j < 0 or arr[j] <= key ‚Üí place key
      state.phase = 'place';
      return;
    }

    if (state.phase === 'place'){
      // place key into hole+0 (current hole index)
      state.arr[state.hole] = state.key;
      setBarValue(state.hole, state.key);

      // mark prefix up to i as sorted and advance i
      state.i = state.i + 1;
      state.phase = 'pick';
      paint();
      return;
    }
  }

  async function run(){
    if (state.running){
      state.running = false;
      btnPlay.textContent = '‚ñ∂ Play';
      return;
    }
    state.running = true;
    btnPlay.textContent = '‚è∏ Pause';
    while (state.running && state.i < state.n){
      await stepOnce();
      await wait(state.delay * 0.6);
    }
    state.running = false;
    btnPlay.textContent = '‚ñ∂ Play';
  }

  // ---------- Controls ----------
  function reset(arr){
    state.arr = arr.slice();
    state.n = state.arr.length;
    state.i = 1;
    state.j = 0;
    state.key = null;
    state.hole = 1;
    state.phase = 'pick';
    state.cmp = 0;
    state.shf = 0;
    state.running = false;
    btnPlay.textContent = '‚ñ∂ Play';
    buildChart();
  }

  btnRandom.addEventListener('click', ()=>{
    const n = clamp(parseInt(elSize.value||'0',10), 3, 80);
    elSize.value = n;
    reset(randomArray(n));
  });

  btnNearly.addEventListener('click', ()=>{
    const n = clamp(parseInt(elSize.value||'0',10), 3, 80);
    elSize.value = n;
    reset(nearlySortedArray(n));
  });

  btnPlay.addEventListener('click', run);
  btnStep.addEventListener('click', stepOnce);
  btnReset.addEventListener('click', ()=> reset(state.arr));

  elSpeed.addEventListener('input', (e)=>{
    state.delay = speedToDelay(+e.target.value);
    elSpeedLabel.textContent = labelSpeed(+e.target.value);
  });

  // ---------- Init ----------
  (function init(){
    const n = clamp(parseInt(elSize.value||'0',10), 3, 80);
    elSize.value = n;
    state.delay = speedToDelay(+elSpeed.value);
    elSpeedLabel.textContent = labelSpeed(+elSpeed.value);
    reset(randomArray(n));
  })();
</script>
</body>
</html>
