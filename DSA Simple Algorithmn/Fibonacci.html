<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fibonacci Visualization (Fixed Index Labels)</title>
<style>
  :root{
    --bg:#0f1220; --panel:#161a2d; --panel-2:#1e2340;
    --accent:#6cf3ff; --accent-2:#8ae9c1;
    --text:#ecf2ff; --muted:#a6b0cf;
    --ok:#84fab0; --slot:#2a305a; --chip:#39407a;
    --shadow:0 10px 30px rgba(0,0,0,.35);
    --radius:16px; --gap:14px; --speed:300ms;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,Arial;
    min-height:100dvh; display:grid; place-items:center; padding:24px;
  }
  .wrap{ width:min(900px,92vw); }
  .panel{
    background:linear-gradient(180deg,var(--panel),var(--panel-2));
    border-radius:var(--radius); box-shadow:var(--shadow); padding:22px;
  }
  h1{font-size:20px;margin:.25rem 0 1rem}
  p{color:var(--muted); margin:.5rem 0 1.25rem}

  .controls{
    display:flex; flex-wrap:wrap; gap:var(--gap); align-items:center; margin-bottom:16px;
  }
  button{
    appearance:none; border:0; border-radius:12px;
    background:linear-gradient(180deg,var(--accent),var(--accent-2));
    color:#041218; font-weight:700; padding:10px 16px; cursor:pointer;
    transition:transform .08s ease; box-shadow:0 6px 18px rgba(0,0,0,.25);
  }
  button[disabled]{opacity:.6; cursor:not-allowed}
  button:active{transform:translateY(1px)}
  .slider{ display:flex; align-items:center; gap:8px; color:var(--muted); }
  .slider input{ accent-color:var(--accent) }
  .status{ min-height:1.25rem; color:var(--ok); font-weight:600; margin-left:auto; }

  /* chart now has extra bottom padding so indices aren’t clipped */
  .chart{
    height:320px; /* slightly taller */
    padding:16px 16px 40px; /* extra bottom space */
    border-radius:12px; background:var(--slot);
    display:flex; align-items:flex-end; gap:10px; overflow:hidden;
  }
  .bar{
    flex:1 1 0; min-width:28px; position:relative;
    background:linear-gradient(180deg, rgba(108,243,255,.35), rgba(138,233,193,.6));
    border:1px solid rgba(255,255,255,.08);
    border-radius:8px 8px 0 0;
    height:0px;
    transition:height var(--speed) ease, transform var(--speed) ease, box-shadow var(--speed) ease, filter var(--speed) ease;
  }
  .bar.pair{
    box-shadow:0 0 0 2px rgba(108,243,255,.55) inset, 0 10px 24px rgba(0,0,0,.25);
    transform:translateY(-2px);
    filter:brightness(1.15);
  }
  .bar.new{
    box-shadow:0 0 0 2px rgba(138,233,193,.6) inset, 0 14px 28px rgba(0,0,0,.35);
    filter:brightness(1.25);
  }
  .bar .value{
    position:absolute; top:-24px; left:50%; transform:translateX(-50%);
    font-size:12px; color:var(--text); opacity:.9;
  }
  .bar .label{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:-22px; /* was -28px, brought closer */
    font-size:12px; color:var(--muted); white-space:nowrap; user-select:none;
  }

  .legend{
    display:flex; gap:12px; align-items:center; color:var(--muted);
    font-size:12px; margin-top:10px;
  }
  .dot{width:10px; height:10px; border-radius:50%;}
  .dot.pair{background:var(--accent)}
  .dot.new{background:var(--accent-2)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Fibonacci Visualization</h1>
      <p>Generates the Fibonacci sequence, highlighting the <strong>two selected terms</strong> used for the next value.</p>

      <div class="controls">
        <button id="actionBtn">Create</button>
        <div class="slider">
          <label for="spd">Speed:</label>
          <input id="spd" type="range" min="50" max="1200" step="25" value="400" />
          <span id="spdVal">400 ms</span>
        </div>
        <div class="slider">
          <label for="len">Terms:</label>
          <input id="len" type="range" min="2" max="30" step="1" value="12" />
          <span id="lenVal">12</span>
        </div>
        <div class="status" id="status"></div>
      </div>

      <div class="chart" id="chart" aria-label="Fibonacci bars"></div>

      <div class="legend">
        <div class="dot pair"></div> selected pair (F(n−2), F(n−1))
        <div class="dot new"></div> new term F(n)
      </div>
    </div>
  </div>

<script>
(() => {
  const chart  = document.getElementById('chart');
  const btn    = document.getElementById('actionBtn');
  const spd    = document.getElementById('spd');
  const spdVal = document.getElementById('spdVal');
  const len    = document.getElementById('len');
  const lenVal = document.getElementById('lenVal');
  const status = document.getElementById('status');

  const DRAW_HEIGHT = 240; // bar drawing height inside chart (excludes padding)

  const state = {
    running: false,
    delay: +spd.value,
    targetLen: +len.value,
    data: [0, 1]
  };

  spd.addEventListener('input', () => {
    state.delay = +spd.value;
    spdVal.textContent = `${state.delay} ms`;
  });

  len.addEventListener('input', () => {
    state.targetLen = +len.value;
    lenVal.textContent = state.targetLen;
  });

  btn.addEventListener('click', () => {
    if (!state.running && btn.textContent === 'Create') {
      run();
    } else {
      reset();
    }
  });

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  function maxVal(){ return Math.max(1, ...state.data); }
  function heightFor(val){ return Math.round((val / maxVal()) * DRAW_HEIGHT); }

  function clearClasses(){
    Array.from(chart.children).forEach(b => b.classList.remove('pair','new'));
  }

  function ensureBars(){
    // create missing bars
    for (let i = chart.children.length; i < state.data.length; i++) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.dataset.index = i;

      const value = document.createElement('span');
      value.className = 'value';
      const label = document.createElement('span');
      label.className = 'label';
      bar.appendChild(value);
      bar.appendChild(label);

      chart.appendChild(bar);
    }
    // update all bars
    const m = maxVal();
    Array.from(chart.children).forEach((bar, i) => {
      const val = state.data[i] ?? 0;
      bar.querySelector('.value').textContent = val || '';
      bar.querySelector('.label').textContent = i;
      const target = Math.round((val/m) * DRAW_HEIGHT);
      requestAnimationFrame(()=>{ bar.style.height = target+'px'; });
    });
  }

  async function run(){
    state.running = true;
    btn.disabled = true;
    btn.textContent = 'Running…';
    status.textContent = '';

    for (let n = state.data.length; n < state.targetLen; n++) {
      clearClasses();
      const barA = chart.children[n-2], barB = chart.children[n-1];
      if (barA) barA.classList.add('pair');
      if (barB) barB.classList.add('pair');
      await sleep(state.delay);

      const next = state.data[n-1] + state.data[n-2];
      state.data.push(next);
      ensureBars();

      clearClasses();
      const newBar = chart.children[n];
      if (newBar) newBar.classList.add('new');
      await sleep(state.delay);
    }

    clearClasses();
    btn.disabled = false;
    btn.textContent = 'Reset';
    status.textContent = 'Done!';
    state.running = false;
  }

  function reset(){
    state.running = false;
    state.data = [0,1];
    btn.textContent = 'Create';
    chart.innerHTML = '';
    ensureBars();
    status.textContent = '';
  }

  // init
  spdVal.textContent = `${state.delay} ms`;
  lenVal.textContent = state.targetLen;
  ensureBars();
})();
</script>
</body>
</html>
